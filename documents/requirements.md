# 要件定義書：個人向け動画管理システム Doga

## 1. サービス概要

自分専用の動画ライブラリをストレージ上に構築し、スマホから快適に視聴・管理・記録（利用履歴）を行うためのWebアプリケーション。

---

## 2. 機能要件

### ① 動画管理・視聴

* **動画再生:** H.264/MP4等のストリーミング再生（スマホブラウザ最適化）。
* **メタデータ取得:** 動画の時間（秒）、解像度、フォーマット等の自動取得。
* **サムネイル生成:** 登録時に、動画からプレビュー画像を自動生成。
* **お気に入り:** ワンタップで「お気に入り」フラグをオン/オフ。
* **フォルダ/ストレージ連携:** 指定したストレージ（S3等）のパスから動画を紐付け。

### ② タグ付けシステム

* **マルチタグ:** 1つの動画に対して複数の属性（ジャンル、出演者、シチュエーション等）を付与。
* **タグ検索:** 複数タグの積集合（AND検索）による絞り込み。

### ③ 利用記録機能（コア機能）

* **記録ボタン:** 動画再生画面に専用ボタンを設置し、実行を記録。
* **ジャーナル統計:**
  * 動画ごとの「累計実行数」表示。
  * カレンダー形式での「利用記録（草生やし）」表示。
  * 直近でよく使っている動画のレコメンド。

### ④ スマートフォン最適化

* **PWA対応:** ホーム画面に追加し、フルスクリーンでアプリのように利用可能。
* **レスポンシブデザイン:** 片手操作を前提としたUI（画面下部にナビゲーションなど）。

---

## 3. 非機能要件

### ① セキュリティ / プライバシー

* **認証機能:** Basic認証、または簡単なパスワード認証（自分のみがアクセス可能）。
* **プライベート配信:** 動画URLに有効期限付き署名（Pre-signed URL）を使用し、直リンクを防止。

### ② パフォーマンス

* **高速な初期表示:** SvelteKit (SSR) を活用した、ストレスのないページ遷移。
* **軽量な通信:** Rust (Axum) による高速なメタデータ返却。

---

## 4. 技術スタック・アーキテクチャ

| レイヤー | 技術 |
| --- | --- |
| **Frontend** | **Svelte 5 + SvelteKit** |
| **Backend** | **Rust (Axum)** (REST API / Video Streaming) |
| **Database** | **PostgreSQL** (Metadata / Nut Entries) |
| **ORM** | **sqlx** (Type-safe SQL) |
| **Infrastructure** | **Docker** (Local & Server deployment) |

---

## 5. データベース設計（主要エンティティ）

| テーブル名 | 役割 | 主要カラム |
| --- | --- | --- |
| `videos` | 動画の基本情報 | `id`, `title`, `duration`, `file_path`, `is_favorite`, `updated_at` |
| `tags` | タグの定義 | `id`, `name`, `updated_at` |
| `video_tags` | 動画とタグの紐付け | `video_id`, `tag_id` |
| `nut_entries` | 利用記録 | `id`, `video_id` |

---

## 6. 画面設計案（UI Flow）

1. **HOME:** 最近追加された動画、お気に入り動画、今日の「記録」状況。
2. **LIBRARY:** 全動画一覧（無限スクロール）、タグフィルタ、検索。
3. **PLAYER:** 動画再生。シークバー、**【Done】ボタン**、タグ表示。
4. **STATS:** カレンダー形式の利用履歴、タグ別ランキング。

---

## 7. 今後の拡張性（v2以降）

* **自動タグ付け:** AIを活用した動画解析によるタグ提案。
* **複数サーバー連携:** 複数のHDDやクラウドストレージを横断して管理。

---
